{"version":3,"sources":["../../../src/common/middleware/user-agent.middleware.ts"],"sourcesContent":["import { Injectable, NestMiddleware } from '@nestjs/common';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport * as useragent from 'express-useragent';\r\n\r\n@Injectable()\r\nexport class UserAgentMiddleware implements NestMiddleware {\r\n  use(req: Request, res: Response, next: NextFunction) {\r\n    const userAgentString = req.headers['user-agent'];\r\n\r\n    if (!userAgentString) {\r\n      console.error('No User-Agent header found');\r\n      // Handle the case where User-Agent header is not present\r\n      req['userAgent'] = {\r\n        platform: 'Unknown',\r\n        browser: 'Unknown',\r\n        versionBrowser: 'Unknown',\r\n        versionPlatform: 'Unknown',\r\n        ip: req.ip,\r\n      };\r\n      return next(); // Proceed to the next middleware or request handler\r\n    }\r\n\r\n    try {\r\n      const agent = useragent.parse(userAgentString);\r\n      req['userAgent'] = {\r\n        platform: agent.os,\r\n        browser: agent.browser,\r\n        versionBrowser: agent.version,\r\n        versionPlatform: agent.osVersion,\r\n        ip: req.ip,\r\n      };\r\n    } catch (error) {\r\n      console.error('Error parsing User-Agent:', error);\r\n      req['userAgent'] = {\r\n        platform: 'Unknown',\r\n        browser: 'Unknown',\r\n        versionBrowser: 'Unknown',\r\n        versionPlatform: 'Unknown',\r\n        ip: req.ip,\r\n      };\r\n    }\r\n\r\n    next();\r\n  }\r\n}\r\n"],"names":["UserAgentMiddleware","use","req","res","next","userAgentString","headers","console","error","platform","browser","versionBrowser","versionPlatform","ip","agent","useragent","parse","os","version","osVersion"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBAL8B;0EAEhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGpB,IAAA,AAAMA,sBAAN,MAAMA;IACXC,IAAIC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,EAAE;QACnD,MAAMC,kBAAkBH,IAAII,OAAO,CAAC,aAAa;QAEjD,IAAI,CAACD,iBAAiB;YACpBE,QAAQC,KAAK,CAAC;YACd,yDAAyD;YACzDN,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAU;gBACVC,SAAS;gBACTC,gBAAgB;gBAChBC,iBAAiB;gBACjBC,IAAIX,IAAIW,EAAE;YACZ;YACA,OAAOT,QAAQ,oDAAoD;QACrE;QAEA,IAAI;YACF,MAAMU,QAAQC,kBAAUC,KAAK,CAACX;YAC9BH,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAUK,MAAMG,EAAE;gBAClBP,SAASI,MAAMJ,OAAO;gBACtBC,gBAAgBG,MAAMI,OAAO;gBAC7BN,iBAAiBE,MAAMK,SAAS;gBAChCN,IAAIX,IAAIW,EAAE;YACZ;QACF,EAAE,OAAOL,OAAO;YACdD,QAAQC,KAAK,CAAC,6BAA6BA;YAC3CN,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAU;gBACVC,SAAS;gBACTC,gBAAgB;gBAChBC,iBAAiB;gBACjBC,IAAIX,IAAIW,EAAE;YACZ;QACF;QAEAT;IACF;AACF"}