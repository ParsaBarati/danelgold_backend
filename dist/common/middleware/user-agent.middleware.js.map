{"version":3,"sources":["../../../src/common/middleware/user-agent.middleware.ts"],"sourcesContent":["import { Injectable, NestMiddleware } from '@nestjs/common';\nimport { Request, Response, NextFunction } from 'express';\nimport * as useragent from 'express-useragent';\n\n@Injectable()\nexport class UserAgentMiddleware implements NestMiddleware {\n  use(req: Request, res: Response, next: NextFunction) {\n    const userAgentString = req.headers['user-agent'];\n\n    if (!userAgentString) {\n      console.error('No User-Agent header found');\n      // Handle the case where User-Agent header is not present\n      req['userAgent'] = {\n        platform: 'Unknown',\n        browser: 'Unknown',\n        versionBrowser: 'Unknown',\n        versionPlatform: 'Unknown',\n        ip: req.ip,\n      };\n      return next(); // Proceed to the next middleware or request handler\n    }\n\n    try {\n      const agent = useragent.parse(userAgentString);\n      req['userAgent'] = {\n        platform: agent.os,\n        browser: agent.browser,\n        versionBrowser: agent.version,\n        versionPlatform: agent.osVersion,\n        ip: req.ip,\n      };\n    } catch (error) {\n      console.error('Error parsing User-Agent:', error);\n      req['userAgent'] = {\n        platform: 'Unknown',\n        browser: 'Unknown',\n        versionBrowser: 'Unknown',\n        versionPlatform: 'Unknown',\n        ip: req.ip,\n      };\n    }\n\n    next();\n  }\n}\n"],"names":["UserAgentMiddleware","use","req","res","next","userAgentString","headers","console","error","platform","browser","versionBrowser","versionPlatform","ip","agent","useragent","parse","os","version","osVersion"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBAL8B;0EAEhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGpB,IAAA,AAAMA,sBAAN,MAAMA;IACXC,IAAIC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,EAAE;QACnD,MAAMC,kBAAkBH,IAAII,OAAO,CAAC,aAAa;QAEjD,IAAI,CAACD,iBAAiB;YACpBE,QAAQC,KAAK,CAAC;YACd,yDAAyD;YACzDN,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAU;gBACVC,SAAS;gBACTC,gBAAgB;gBAChBC,iBAAiB;gBACjBC,IAAIX,IAAIW,EAAE;YACZ;YACA,OAAOT,QAAQ,oDAAoD;QACrE;QAEA,IAAI;YACF,MAAMU,QAAQC,kBAAUC,KAAK,CAACX;YAC9BH,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAUK,MAAMG,EAAE;gBAClBP,SAASI,MAAMJ,OAAO;gBACtBC,gBAAgBG,MAAMI,OAAO;gBAC7BN,iBAAiBE,MAAMK,SAAS;gBAChCN,IAAIX,IAAIW,EAAE;YACZ;QACF,EAAE,OAAOL,OAAO;YACdD,QAAQC,KAAK,CAAC,6BAA6BA;YAC3CN,GAAG,CAAC,YAAY,GAAG;gBACjBO,UAAU;gBACVC,SAAS;gBACTC,gBAAgB;gBAChBC,iBAAiB;gBACjBC,IAAIX,IAAIW,EAAE;YACZ;QACF;QAEAT;IACF;AACF"}